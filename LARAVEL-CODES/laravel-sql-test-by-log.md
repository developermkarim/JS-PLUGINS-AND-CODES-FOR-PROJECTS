## LARAVEL LOG TO TEST
---
### Debugging Sql QUery by Log
Yes, the `\DB::listen` code snippet can be used with both raw SQL queries and Eloquent ORM queries in Laravel. The purpose of this snippet is to log queries executed by the database, regardless of whether they are raw SQL queries or queries generated by Eloquent.

Here's how you can use it with Eloquent ORM:

```php
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Log;
use App\Models\YourModel; // Replace with your actual model

public function someControllerMethod()
{
    // Your controller logic...

    // Log Eloquent queries specific to this controller method
    DB::listen(function ($query) {
        Log::info('Eloquent Query: ' . $query->sql);
        Log::info('Eloquent Bindings: ' . json_encode($query->bindings));
        Log::info('Eloquent Time: ' . $query->time);
    });

    // Example Eloquent query
    $result = YourModel::where('column', 'value')->get();

    // More controller logic...
}

/* OR */
        \DB::listen(function ($query) {
        \Log::info($query->sql);
        \Log::info($query->bindings);
        \Log::info($query->time);
    });
```
**Notes** Can We Set it in Middleware to show the result globally

```php
use Illuminate\Support\ServiceProvider;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Log;

class AppServiceProvider extends ServiceProvider
{
    public function register()
    {
        if ($this->app->isLocal()) {
            DB::listen(function ($query) {
                Log::info($query->sql);
                Log::info($query->bindings);
                Log::info($query->time);
            });
        }
    }
}

/* OR CREATING MIDDLEWARE */
namespace App\Http\Middleware;

use Closure;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Log;

class LogQueriesMiddleware
{
    public function handle($request, Closure $next)
    {
        if (config('app.debug')) {
            DB::listen(function ($query) {
                Log::info($query->sql);
                Log::info($query->bindings);
                Log::info($query->time);
            });
        }

        return $next($request);
    }
}

```

**Result of Log above in laravel.log**
```sql
[2023-11-26 07:03:18] local.INFO: select * from `properties` where `id` = ? or `id` = ? limit 1  
[2023-11-26 07:03:18] local.INFO: array (
  0 => '42',
  1 => '42',
)  
[2023-11-26 07:03:18] local.INFO: 0.51  
[2023-11-26 07:03:18] local.INFO: select * from `multi_images` where `property_id` = ? or `property_id` = ?  
[2023-11-26 07:03:18] local.INFO: array (
  0 => 42,
  1 => '42',
)  
[2023-11-26 07:03:18] local.INFO: 0.8  
[2023-11-26 07:03:18] local.INFO: Property ID: 42  
[2023-11-26 07:03:18] local.INFO: Multi Images Relationship: Illuminate\Support\Collection Object
(
    [items:protected] => Array
        (
            [0] => stdClass Object
                (
                    [id] => 56
                    [property_id] => 42
                    [photo_name] => upload/property/multi-image/-0119140.jpg
                    [created_at] => 2023-11-24 13:19:14
                    [updated_at] => 2023-11-26 06:40:58
                    [deleted_at] => 2023-11-26 06:40:58
                )

            [1] => stdClass Object
                (
                    [id] => 57
                    [property_id] => 42
                    [photo_name] => upload/property/multi-image/-0119380.jpg
                    [created_at] => 2023-11-24 13:19:38
                    [updated_at] => 2023-11-26 06:40:58
                    [deleted_at] => 2023-11-26 06:40:58
                )

            [2] => stdClass Object
                (
                    [id] => 58
                    [property_id] => 42
                    [photo_name] => upload/property/multi-image/-0119381.jpg
                    [created_at] => 2023-11-24 13:19:38
                    [updated_at] => 2023-11-26 06:40:58
                    [deleted_at] => 2023-11-26 06:40:58
                )

        )

    [escapeWhenCastingToString:protected] => 
)
  
[2023-11-26 07:03:18] local.INFO: Multi Images are: Illuminate\Support\Collection Object
(
    [items:protected] => Array
        (
            [0] => stdClass Object
                (
                    [id] => 56
                    [property_id] => 42
                    [photo_name] => upload/property/multi-image/-0119140.jpg
                    [created_at] => 2023-11-24 13:19:14
                    [updated_at] => 2023-11-26 06:40:58
                    [deleted_at] => 2023-11-26 06:40:58
                )

            [1] => stdClass Object
                (
                    [id] => 57
                    [property_id] => 42
                    [photo_name] => upload/property/multi-image/-0119380.jpg
                    [created_at] => 2023-11-24 13:19:38
                    [updated_at] => 2023-11-26 06:40:58
                    [deleted_at] => 2023-11-26 06:40:58
                )

            [2] => stdClass Object
                (
                    [id] => 58
                    [property_id] => 42
                    [photo_name] => upload/property/multi-image/-0119381.jpg
                    [created_at] => 2023-11-24 13:19:38
                    [updated_at] => 2023-11-26 06:40:58
                    [deleted_at] => 2023-11-26 06:40:58
                )

        )

    [escapeWhenCastingToString:protected] => 
)
  
[2023-11-26 07:03:18] local.INFO: delete from `multi_images` where `property_id` = ?  
[2023-11-26 07:03:18] local.INFO: array (
  0 => 42,
)  
[2023-11-26 07:03:18] local.INFO: 119.64  
[2023-11-26 07:03:18] local.INFO: delete from `properties` where `id` = ?  
[2023-11-26 07:03:18] local.INFO: array (
  0 => 42,
)  
[2023-11-26 07:03:18] local.INFO: 116.35  

```

### **Log Using IN Controller**
---
Certainly! In addition to the basic logging methods, I'll include some additional logging methods and demonstrate how they can be used in a Laravel controller class. Here's an extended example:

```php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Log;

class ProductController extends Controller
{
    public function create(Request $request)
    {
        try {
            // Log the incoming request data for debugging
            Log::info('Product Creation Request Data:', $request->all());

            // Validate the request data
            $request->validate([
                'name' => 'required|string|max:255',
                'price' => 'required|numeric',
                // Add other validation rules as needed
            ]);

            // Perform product creation logic
            // ...

            // Log a success message
            Log::info('Product Created Successfully:', ['product_name' => $request->input('name')]);

            // Return a response indicating success
            return response()->json(['message' => 'Product created successfully'], 201);
        } catch (\Exception $e) {
            // Log the error message and details
            Log::error('Product Creation Error:', ['message' => $e->getMessage(), 'trace' => $e->getTrace()]);

            // Log an emergency alert for critical errors
            Log::emergency('Critical Error during Product Creation', ['exception' => $e]);

            // Return an error response
            return response()->json(['error' => 'Product creation failed'], 500);
        }
    }

    public function update(Request $request, $productId)
    {
        try {
            // Log the incoming request data for debugging
            Log::info('Product Update Request Data:', $request->all());

            // Validate the request data
            $request->validate([
                'name' => 'required|string|max:255',
                'price' => 'required|numeric',
                // Add other validation rules as needed
            ]);

            // Perform product update logic
            // ...

            // Log a success message
            Log::info('Product Updated Successfully:', ['product_id' => $productId]);

            // Return a response indicating success
            return response()->json(['message' => 'Product updated successfully'], 200);
        } catch (\Exception $e) {
            // Log the error message and details
            Log::error('Product Update Error:', ['message' => $e->getMessage(), 'trace' => $e->getTrace()]);

            // Log a warning for non-critical errors
            Log::warning('Non-Critical Error during Product Update', ['exception' => $e]);

            // Return an error response
            return response()->json(['error' => 'Product update failed'], 500);
        }
    }

    public function delete($productId)
    {
        try {
            // Log a debug message for product deletion request
            Log::debug('Product Deletion Requested:', ['product_id' => $productId]);

            // Perform product deletion logic
            // ...

            // Log a success message
            Log::info('Product Deleted Successfully:', ['product_id' => $productId]);

            // Return a response indicating success
            return response()->json(['message' => 'Product deleted successfully'], 200);
        } catch (\Exception $e) {
            // Log the error message and details
            Log::error('Product Deletion Error:', ['message' => $e->getMessage(), 'trace' => $e->getTrace()]);

            // Log an alert for unexpected errors during deletion
            Log::alert('Unexpected Error during Product Deletion', ['exception' => $e]);

            // Return an error response
            return response()->json(['error' => 'Product deletion failed'], 500);
        }
    }
}
```

In this extended example:

- The `Log::emergency()` method is used for critical errors during product creation.
- The `Log::warning()` method is used for non-critical errors during product update.
- The `Log::debug()` method is used for debugging messages during product deletion.
- The `Log::alert()` method is used for unexpected errors during product deletion.

These additional methods provide more granularity in categorizing log messages based on their severity and importance. Customize the log messages and levels based on your specific needs and the nature of your application.

**Show The Logs**
In the Path `laravel-real-state-project\storage\logs\laravel.log`
or CLI Command 

```bash
cat storage/logs/laravel.log
```

Remember to adjust the log levels (`info`, `debug`, `error`, etc.) based on the severity of the information. Regularly review logs to identify and address issues proactively, ensuring a smooth and secure operation of your e-commerce website.
